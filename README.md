# –¢–∏–ø–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –¥–∞—Ç–∞-–∏–Ω–∂–µ–Ω–µ—Ä–∞

–¢—ã –æ—Å–≤–æ–∏–ª SQL, –Ω–µ–º–Ω–æ–≥–æ ETL –∏ —É–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—à—å, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞–π–ø–ª–∞–π–Ω—ã? –ü–æ—Ä–∞ –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –æ–¥–Ω–æ–π –∏–∑ –±–∞–∑–æ–≤—ã—Ö, –Ω–æ –≤–∞–∂–Ω—ã—Ö
–∑–∞–¥–∞—á –≤ –∂–∏–∑–Ω–∏ –¥–∞—Ç–∞-–∏–Ω–∂–µ–Ω–µ—Ä–∞ ‚Äî —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è Slowly Changing Dimension Type 2 (SCD2).

–í —ç—Ç–æ–º [–≤–∏–¥–µ–æ](https://youtu.be/Q65vYLlEDQQ) —è –æ–±—ä—è—Å–Ω—è—é:
- –ß—Ç–æ —Ç–∞–∫–æ–µ –º–µ–¥–ª–µ–Ω–Ω–æ –∏–∑–º–µ–Ω—è—é—â–∏–µ—Å—è –∏–∑–º–µ—Ä–µ–Ω–∏—è (Slowly Changing Dimensions)
- –ü–æ—á–µ–º—É SCD2 –≤–∞–∂–Ω–∞ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç–∏
- –ö–∞–∫ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å SCD2: –¥–∞—Ç—ã, —Ñ–ª–∞–≥–∏, –≤–µ—Ä—Å–∏–æ–Ω–Ω–æ—Å—Ç—å
- –ß—Ç–æ —É—á–∏—Ç—ã–≤–∞—Ç—å –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å SCD2 –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö
- –ö–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å SCD2 –Ω–∞ SQL

üìå –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è: SCD2 ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ç–µ—Ö–Ω–∏–∫–∞, —ç—Ç–æ —Å–ø–æ—Å–æ–± —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ –ø–æ–≤—ã—Å–∏—Ç—å –¥–æ–≤–µ—Ä–∏–µ –∫ –¥–∞–Ω–Ω—ã–º.
–ö–∞–∂–¥—ã–π –¥–∞—Ç–∞-–∏–Ω–∂–µ–Ω–µ—Ä –¥–æ–ª–∂–µ–Ω –ø–æ–Ω–∏–º–∞—Ç—å, –∫–∞–∫ –µ—ë –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å –∏ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ –Ω—É–∂–¥—ã –±–∏–∑–Ω–µ—Å–∞.

üíº –•–æ—á–µ—à—å —É—Å–∫–æ—Ä–∏—Ç—å —Ä–æ—Å—Ç –≤ –∫–∞—Ä—å–µ—Ä–µ? –Ø –ø—Ä–µ–¥–ª–∞–≥–∞—é –º–µ–Ω—Ç–æ—Ä—Å—Ç–≤–æ –ø–æ –¥–∞—Ç–∞-–∏–Ω–∂–µ–Ω–µ—Ä–∏–∏ –∏ IT-–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏:
- –ú–µ–Ω—Ç–æ—Ä—Å—Ç–≤–æ: https://korsak0v.notion.site/Data-Engineer-185c62fdf79345eb9da9928356884ea0
- –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏: https://korsak0v.notion.site/Data-Engineer-185c62fdf79345eb9da9928356884ea0

üìö –£–ø–æ–º—è–Ω—É—Ç—ã–µ –≤–∏–¥–µ–æ:
- –ó–∞—á–µ–º –Ω—É–∂–Ω—ã pet-–ø—Ä–æ–µ–∫—Ç—ã?: https://youtu.be/pVwbIntazLo
- –õ—É—á—à–∏–π –ø–µ—Ç-–ø—Ä–æ–µ–∫—Ç –¥–ª—è –¥–∞—Ç–∞-–∏–Ω–∂–µ–Ω–µ—Ä–∞ (The best pet-project for a data-engineer): https://youtu.be/MQPHgUQvKnI

üîî –ü–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ –∫–∞–Ω–∞–ª, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å —Ä–∞–∑–±–∏—Ä–∞—Ç—å—Å—è –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á–∞—Ö –¥–∞—Ç–∞-–∏–Ω–∂–µ–Ω–µ—Ä–æ–≤, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –≤ —Ç–µ–æ—Ä–∏–∏. –î–µ–ª–∏—Ç–µ—Å—å –≤
–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö, –ø—Ä–∏—Ö–æ–¥–∏–ª–æ—Å—å –ª–∏ –≤–∞–º —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å SCD2 ‚Äî –∏ —Å –∫–∞–∫–∏–º–∏ —Ç—Ä—É–¥–Ω–æ—Å—Ç—è–º–∏ –≤—ã —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å.

–ú–µ–Ω—Ç–æ—Ä—Å—Ç–≤–æ/–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –ø–æ IT ‚Äì https://korsak0v.notion.site/Data-Engineer-185c62fdf79345eb9da9928356884ea0
TG –∫–∞–Ω–∞–ª ‚Äì https://t.me/DataLikeQWERTY
Instagram ‚Äì https://www.instagram.com/i__korsakov/
Habr ‚Äì https://habr.com/ru/users/k0rsakov/publications/articles/

–¢–∞–π–º–∏–Ω–≥–∏:
00:00 ‚Äì –ù–∞—á–∞–ª–æ
00:10 ‚Äì –û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞—Ç–∏–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
01:28 ‚Äì –ß—Ç–æ —Ç–∞–∫–æ–µ SCD
03:50 ‚Äî SCD2 (—Å—Ç–∞–Ω–¥–∞—Ä—Ç)
05:47 ‚Äì –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
06:24 ‚Äì –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
06:44 ‚Äì –ù–∞—Å—Ç—Ä–æ–π–∫–∞ git‚Äì–æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
07:52 ‚Äì –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
08:32 ‚Äì –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞
10:00 ‚Äì –ó–∞–ø—É—Å–∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
11:03 ‚Äì –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–æ–≤ –¥–∞–Ω–Ω—ã—Ö
11:21 ‚Äì –î–µ–º–æ –ø—Ä–∏–º–µ—Ä–∞ SCD2 –∏ –µ–≥–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π
14:33 ‚Äì –†–µ–∞–ª–∏–∑–∞—Ü–∏—è SCD2 —Å –Ω—É–ª—è
15:07 ‚Äì –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º –∏ –º–æ–¥–µ–ª–µ–π
18:05 ‚Äì –ù–∞–ø–æ–ª–Ω–µ–Ω–∏–µ raw –¥–∞–Ω–Ω—ã–º–∏
18:45 ‚Äì –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä–∞) –≤ PyCharm
21:40 ‚Äì –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ raw –¥–∞–Ω–Ω—ã—Ö
25:10 ‚Äì –°–æ–∑–¥–∞–Ω–∏–µ ods –¥–∞–Ω–Ω—ã—Ö
27:45 ‚Äì –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ ods –¥–∞–Ω–Ω—ã—Ö
29:47 ‚Äì –ù–∞–ø–æ–ª–Ω–µ–Ω–∏–µ dds –¥–∞–Ω–Ω—ã–º–∏ (–ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ SCD2)
32:30 ‚Äì –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ dds –¥–∞–Ω–Ω—ã—Ö (SCD2)
35:48 ‚Äì –†–µ–∑—é–º–µ –∏ –≤–æ–∑–º–æ–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞

#SCD2 #SlowlyChangingDimension #dataengineering #–¥–∞—Ç–∞–∏–Ω–∂–µ–Ω–µ—Ä #ETL #SQL #Spark #–ø—Ä–æ—Ñ–µ—Å—Å–∏—è–¥–∞—Ç–∞–∏–Ω–∂–µ–Ω–µ—Ä #–∫–∞—Ä—å–µ—Ä–∞–≤IT
#—Ö—Ä–∞–Ω–∏–ª–∏—â–µ–¥–∞–Ω–Ω—ã—Ö #datawarehouse #–º–µ–Ω—Ç–æ—Ä—Å—Ç–≤–æIT #–∞–Ω–∞–ª–∏—Ç–∏–∫–∞–¥–∞–Ω–Ω—ã—Ö #–∏—Å—Ç–æ—Ä–∏—è–∏–∑–º–µ–Ω–µ–Ω–∏–π #IT–∫–∞—Ä—å–µ—Ä–∞ #airflow #bigdata
#–∏–Ω–∂–µ–Ω–µ—Ä–¥–∞–Ω–Ω—ã—Ö #–ø—Ä–æ–µ–∫—Ç–¥–ª—è–¥–∞—Ç–∞–∏–Ω–∂–µ–Ω–µ—Ä–∞ #—Ç–∏–ø–æ–≤—ã–µ–∑–∞–¥–∞—á–∏IT

## –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
python3.12 -m venv venv && \
source venv/bin/activate && \
pip install --upgrade pip && \
pip install poetry && \
poetry lock && \
poetry install
```

## –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```bash
docker-compose up -d
```

## –°—Å—ã–ª–∫–∏

- [–õ—É—á—à–∏–π –ø–µ—Ç-–ø—Ä–æ–µ–∫—Ç –¥–ª—è –¥–∞—Ç–∞-–∏–Ω–∂–µ–Ω–µ—Ä–∞ (The best pet-project for a data-engineer)](https://youtu.be/MQPHgUQvKnI)
- [–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã API](https://earthquake.usgs.gov/fdsnws/event/1/#methods)
- [–û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–ª–µ–π –∏–∑ API](https://earthquake.usgs.gov/data/comcat/index.php)
- [airflow docker-compose](https://airflow.apache.org/docs/apache-airflow/2.10.5/docker-compose.yaml)

## Notes

–°—Ö–µ–º—ã –∏ –º–æ–¥–µ–ª–∏ –¥–ª—è –¥–µ–º–æ:

```sql
CREATE SCHEMA stg;

CREATE SCHEMA raw;
DROP TABLE IF EXISTS raw.raw_users;
CREATE TABLE raw.raw_users (
	id uuid NULL,
	created_at timestamp NULL,
	updated_at timestamp NULL,
	first_name text NULL,
	last_name text NULL,
	middle_name text NULL,
	birthday date NULL,
	email text NULL,
	ts_db timestamp NULL
);

CREATE SCHEMA ods;
DROP TABLE IF EXISTS ods.dim_users;
CREATE TABLE ods.dim_users (
	id uuid PRIMARY KEY,
	created_at timestamp NULL,
	updated_at timestamp NULL,
	first_name text NULL,
	last_name text NULL,
	middle_name text NULL,
	birthday date NULL,
	email text NULL
);

CREATE SCHEMA dds;
DROP TABLE IF EXISTS dds.dim_scd2_users;
CREATE TABLE dds.dim_scd2_users (
	id uuid,
	created_at timestamp NULL,
	updated_at timestamp NULL,
	first_name text NULL,
	last_name text NULL,
	middle_name text NULL,
	birthday date NULL,
	email text NULL,
	actual_from timestamp NULL,
	actual_to timestamp NULL,
	ts_db timestamp NULL
);
```
